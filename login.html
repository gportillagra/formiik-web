<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Formiik Web - Login</title>

    <!-- Meta para redes -->
    <meta property="og:title" content="Formiik Web - Login" />
    <meta property="og:description" content="Panel de gestión empresarial en tiempo real." />
    <meta property="og:image" content="/img/Icon.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="/img/Icon.png" />

    <link rel="icon" href="/img/Icon.png" />
    <link href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css" rel="stylesheet" />

    <!-- Tema Formiik Premium -->
    <style>
      :root {
        --formiik-soft-red: #FF8F8F;
        --formiik-soft-yellow: #FFF1CB;
        --formiik-soft-blue: #C2E2FA;
        --formiik-soft-purple: #B7A3E3;
        --formiik-primary: #A78BFA;
        --formiik-primary-dark: #8B5CF6;
        --formiik-gradient: linear-gradient(135deg, var(--formiik-primary), var(--formiik-soft-red));
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 1.5rem;
        min-height: 100vh;
        background: 
          radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
          radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.3) 0%, transparent 50%),
          linear-gradient(135deg, var(--formiik-soft-blue) 0%, var(--formiik-soft-yellow) 50%, var(--formiik-soft-red) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        overflow-x: hidden;
      }

      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
          radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
          radial-gradient(circle at 75% 75%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
        z-index: -1;
        animation: shimmer 20s ease-in-out infinite;
      }

      @keyframes shimmer {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.8; transform: scale(1.05); }
      }

      .login-card {
        width: 100%;
        max-width: 400px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 
          0 25px 45px rgba(0, 0, 0, 0.1),
          0 0 0 1px rgba(255, 255, 255, 0.1);
        overflow: hidden;
        animation: cardFloat 6s ease-in-out infinite;
        transform-origin: center;
      }

      @keyframes cardFloat {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-8px) rotate(0.5deg); }
      }

      .icon-section {
        height: 160px;
        background: var(--formiik-gradient);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
      }

      .icon-section::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
        animation: rotateGlow 4s linear infinite;
      }

      @keyframes rotateGlow {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .main-icon {
        width: 90px;
        height: 90px;
        border-radius: 24px;
        object-fit: contain;
        z-index: 1;
        filter: drop-shadow(0 8px 20px rgba(0,0,0,0.2));
        transition: transform 0.3s ease;
      }

      .main-icon:hover {
        transform: scale(1.05);
      }

      .card-content {
        padding: 2.5rem 2.5rem 2rem;
        text-align: center;
      }

      .login-title {
        font-size: 1.75rem;
        font-weight: 800;
        background: linear-gradient(135deg, #1e1b4b, #4338ca);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0 0 2rem 0;
        letter-spacing: -0.025em;
      }

      .form-group {
        position: relative;
        margin-bottom: 1.75rem;
      }

      .form-label {
        position: absolute;
        top: 1rem;
        left: 1.25rem;
        font-size: 0.95rem;
        font-weight: 500;
        color: #6b7280;
        pointer-events: none;
        transition: all 0.25s ease;
      }

      .form-control {
        width: 100%;
        padding: 1.25rem 1.25rem 0.75rem 1.25rem;
        border: 2px solid transparent;
        border-radius: 16px;
        background: rgba(248, 250, 252, 0.8);
        backdrop-filter: blur(10px);
        font-size: 1rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--formiik-primary);
        background: rgba(255, 255, 255, 0.95);
        box-shadow: 
          0 0 0 4px rgba(167, 139, 250, 0.15),
          0 12px 32px rgba(167, 139, 250, 0.1);
        transform: translateY(-2px);
      }

      .form-control:focus + .form-label,
      .form-control:not(:placeholder-shown) + .form-label {
        top: -0.5rem;
        left: 1rem;
        font-size: 0.75rem;
        color: var(--formiik-primary);
        background: rgba(255, 255, 255, 0.95);
        padding: 0 0.5rem;
      }

      .login-btn {
        width: 100%;
        padding: 1.1rem;
        background: var(--formiik-gradient);
        color: white;
        border: none;
        border-radius: 16px;
        font-size: 1.05rem;
        font-weight: 700;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 12px 32px rgba(167, 139, 250, 0.4);
      }

      .login-btn:hover:not(:disabled) {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(167, 139, 250, 0.5);
      }

      .login-btn:active:not(:disabled) {
        transform: translateY(-2px);
      }

      .login-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
      }

      .btn-glow {
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left 0.5s;
      }

      .login-btn:not(:disabled):hover .btn-glow {
        left: 100%;
      }

      .message {
        font-size: 0.9rem;
        padding: 1rem 1.25rem;
        border-radius: 12px;
        margin: 1.25rem 0;
        display: none;
        animation: slideIn 0.3s ease;
      }

      .error-msg {
        background: rgba(239, 68, 68, 0.15);
        color: #dc2626;
        border: 1px solid rgba(239, 68, 68, 0.3);
      }

      .status-msg {
        background: rgba(34, 197, 94, 0.15);
        color: #166534;
        border: 1px solid rgba(34, 197, 94, 0.3);
      }

      @keyframes slideIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      @media (max-width: 480px) {
        body { padding: 1rem; }
        .login-card { border-radius: 20px; }
        .icon-section { height: 140px; }
        .main-icon { width: 80px; height: 80px; }
        .card-content { padding: 2rem 2rem 1.75rem; }
      }
    </style>
    
    <script src="./config.js"></script>

    <!-- Firebase -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // VERIFICAR SESIÓN ACTIVA al cargar
      onAuthStateChanged(auth, (user) => {
        if (user) {
          window.location.href = '/index.html';
        }
      });

      document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('loginForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('loginBtn');
        const errorMsg = document.getElementById('errorMsg');
        const statusMsg = document.getElementById('statusMsg');

        const setLoading = (loading) => {
          loginBtn.disabled = loading;
          loginBtn.innerHTML = loading 
            ? '<span class="spinner"></span> Ingresando...'
            : 'Entrar <span class="btn-glow"></span>';
        };

        const showError = (msg) => {
          errorMsg.textContent = msg;
          errorMsg.style.display = 'block';
          statusMsg.style.display = 'none';
        };

        const showStatus = (msg) => {
          statusMsg.textContent = msg;
          statusMsg.style.display = 'block';
          errorMsg.style.display = 'none';
        };

        // Spinner CSS inline
        const style = document.createElement('style');
        style.textContent = `
          .spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
          }
          @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        `;
        document.head.appendChild(style);

        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = emailInput.value.trim();
          const password = passwordInput.value;

          if (!email || !password) {
            showError('Completa todos los campos');
            return;
          }

          setLoading(true);
          try {
            await signInWithEmailAndPassword(auth, email, password);
            showStatus('¡Sesión iniciada! Redirigiendo...');
            setTimeout(() => {
              window.location.href = '/index.html';
            }, 1200);
          } catch (error) {
            console.error(error);
            let msg = 'Error al iniciar sesión';
            switch(error.code) {
              case 'auth/user-not-found': msg = 'Usuario no encontrado'; break;
              case 'auth/wrong-password': msg = 'Contraseña incorrecta'; break;
              case 'auth/invalid-email': msg = 'Email inválido'; break;
              case 'auth/too-many-requests': msg = 'Demasiados intentos. Intenta más tarde'; break;
            }
            showError(msg);
          } finally {
            setLoading(false);
          }
        });
      });
    </script>
  </head>
  <body>
    <div class="login-card">
      <div class="icon-section">
        <img src="./img/icon.png" alt="Formiik" class="main-icon" />
      </div>
      
      <div class="card-content">
        <h1 class="login-title">Formiik Web</h1>
        
        <form id="loginForm">
          <div class="form-group">
            <input type="email" id="email" class="form-control" placeholder=" " required />
            <label class="form-label" for="email">Email</label>
          </div>
          
          <div class="form-group">
            <input type="password" id="password" class="form-control" placeholder=" " required />
            <label class="form-label" for="password">Contraseña</label>
          </div>

          <div id="errorMsg" class="message error-msg"></div>
          <div id="statusMsg" class="message status-msg"></div>

          <button type="submit" id="loginBtn" class="login-btn">
            Entrar <span class="btn-glow"></span>
          </button>
        </form>
      </div>
    </div>
  </body>
</html>